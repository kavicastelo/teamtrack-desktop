<div class="profile" [class.loading]="loading">

  <div class="top">
    <div *ngIf="!user.avatar_url"
         class="avatar"
         [style.background]="avatarColor(user.full_name)">
      {{initials(user.full_name)}}
    </div>
    <img *ngIf="user.avatar_url" class="avatar" [src]="user.avatar_url" alt="avatar" />
    <div class="info">
      <h2>{{ user.full_name }}</h2>
      <p class="role">{{ user.role || 'Member' }}</p>
    </div>
  </div>

  <section class="status">
    <h3>Calendar Sync</h3>

    <div class="status-line">
      <span class="dot" [class.on]="calendarStatus?.connected"></span>
      <span class="label">
        Google: {{ calendarStatus?.connected ? 'CONNECTED' : 'NOT CONNECTED' }}
      </span>
    </div>

    <div class="actions" *ngIf="isSelf">
      <button (click)="connect()" *ngIf="!calendarStatus?.connected">
        Connect Google
      </button>

      <button (click)="syncNow()" [disabled]="syncing" *ngIf="calendarStatus?.connected">
        {{ syncing ? 'Syncing...' : 'Sync Now' }}
      </button>

      <button class="danger" (click)="disconnect()" *ngIf="calendarStatus?.connected">
        Disconnect
      </button>
    </div>
  </section>

  <section class="timeline">
    <h3>Availability (Next 7 Days)</h3>
    <div class="bars">
      <div
        *ngFor="let d of getTimelineDays()"
        class="bar"
        [class.busy]="d.busy"
        [title]="d.date | date:'EEE dd'"
      ></div>
    </div>
  </section>

  <section class="upcoming">
    <h3>Upcoming</h3>

    <div *ngFor="let ev of upcoming" class="event-card"
         [title]="
       (ev.summary || 'No Title') + '\n' +
       (ev.start | date:'EEE MMM dd HH:mm') + ' ‚Üí ' + (ev.end | date:'HH:mm') + '\n' +
       visibility(ev) + ' ¬∑ ' +
       ((ev | isRecurring) ? 'Recurring' : 'Single') + '\n' +
       getAttendees(convertJson(ev)).length + ' attendee(s)'
     "
    >
      <div class="title-row">
      <span class="icons">
        <span *ngIf="convertJson(ev) | isBirthday">üéÇ</span>
        <span *ngIf="convertJson(ev) | isRecurring">üîÅ</span>
        <span>{{ convertJson(ev) | visibilityIcon }}</span>
      </span>

        <strong>{{ ev.summary || '(No title)' }}</strong>
      </div>

      <div class="time" [ngClass]="{'all-day': (convertJson(ev) | allDay)}">
        <ng-container *ngIf="!(convertJson(ev) | allDay)">
          {{ ev.start | date:'EEE HH:mm' }} ‚Üí {{ ev.end | date:'HH:mm' }}
        </ng-container>

        <ng-container *ngIf="convertJson(ev) | allDay">
          All-day
        </ng-container>
      </div>

      <div class="meta">
        By {{ convertJson(ev) | creatorName }}
        <span class="pill" *ngIf="ev | isBirthday">
        üéâ Turning {{ computeAgeTurning(ev) }}
      </span>
      </div>

      <div class="attendees-row">
        <ng-container *ngTemplateOutlet="attendeeTpl; context:{ev: convertJson(ev)}"></ng-container>
      </div>
    </div>
  </section>

  <ng-template #attendeeTpl let-ev="ev">
    <div class="attendees" *ngIf="getAttendees(ev).length > 0">
      <div *ngFor="let a of getAttendees(ev) | slice:0:5"
           class="attendee"
           [class.accepted]="a.responseStatus === 'accepted'"
           [class.tentative]="a.responseStatus === 'tentative'"
           [class.declined]="a.responseStatus === 'declined'"
           [style.background]="avatarColor(a)"
           [title]="(a.displayName || a.email) + ' ¬∑ ' + a.responseStatus">

        {{ initials(a) }}
      </div>

      <span *ngIf="getAttendees(ev).length > 5" class="more">
        +{{ getAttendees(ev).length - 5 }}
    </span>
    </div>
  </ng-template>
</div>
