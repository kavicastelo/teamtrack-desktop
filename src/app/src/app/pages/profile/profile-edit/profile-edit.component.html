<div class="profile-root dark-theme">
  <mat-card class="card">
    <div class="header-row">
      <div class="avatar-container" (click)="changeAvatar()">
        <img *ngIf="avatarUrl; else initialsTpl" [src]="avatarUrl" class="avatar" alt="avatar">
        <ng-template #initialsTpl>
          <div class="avatar initials">{{ getInitials(profileForm.value.full_name) }}</div>
        </ng-template>
      </div>

      <div>
        <h2 class="title">Profile</h2>
        <span class="sub">Manage account & availability</span>
      </div>
    </div>

    <form [formGroup]="profileForm" class="form">

      <mat-form-field appearance="fill" class="full">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email">
      </mat-form-field>

      <mat-form-field appearance="fill" class="full">
        <mat-label>Full name</mat-label>
        <input matInput formControlName="full_name" required>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full">
        <mat-label>Timezone</mat-label>
        <input matInput formControlName="timezone">
      </mat-form-field>

      <mat-divider></mat-divider>

      <section class="calendar-block">
        <div class="row">
          <mat-slide-toggle formControlName="calendar_sync_enabled">
            Calendar Sync
          </mat-slide-toggle>

          <span *ngIf="calendarConnected" class="connected-badge">
            â€¢ Connected
          </span>
        </div>

        <div class="calendar-actions">
          <button mat-stroked-button color="primary" (click)="connectCalendar()" *ngIf="!calendarConnected">
            Connect Google Calendar
          </button>

          <button mat-stroked-button color="warn" (click)="disconnectCalendar()" *ngIf="calendarConnected">
            Disconnect
          </button>
        </div>

        <div *ngIf="calendarConnected" class="calendar-status">
          <mat-icon>event</mat-icon>
          Connected to: <strong>{{ calendarId }}</strong>
        </div>
      </section>

      <section *ngIf="calendarConnected">
        <h3 class="section-title">This weekâ€™s busy slots</h3>
        <div class="timeline">
          <div *ngFor="let slot of busySlots" class="slot">
            <div>
              {{ slot.start | date:'EEE HH:mm' }}
              â†’
              {{ slot.end | date:'HH:mm' }}
            </div>
          </div>
          <div *ngIf="busySlots.length === 0" class="empty">
            Youâ€™re free this week ðŸŽ‰
          </div>
        </div>
      </section>

      <mat-divider></mat-divider>

      <mat-form-field appearance="fill" class="full">
        <mat-label>Availability rules</mat-label>
        <textarea
          matInput
          rows="3"
          formControlName="available_times"
          placeholder='Ex: {"mon": "9-17", "fri": "10-14"}'
        ></textarea>
      </mat-form-field>

      <button mat-flat-button
              color="primary"
              class="full submit"
              (click)="save()"
              [disabled]="saving">
        {{ saving ? 'Saving...' : 'Save changes' }}
      </button>
    </form>
  </mat-card>
</div>
